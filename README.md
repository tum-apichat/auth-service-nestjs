# Auth Service (NestJS)

บริการสำหรับการจัดการการยืนยันตัวตนและการอนุญาตในระบบ

## เทคโนโลยีที่ใช้

- **NestJS** - เฟรมเวิร์ค Node.js สำหรับพัฒนา backend ที่มีโครงสร้างแบบ modular
- **TypeScript** - ภาษาโปรแกรมที่เพิ่ม type system ให้ JavaScript
- **Passport.js** - Middleware สำหรับการยืนยันตัวตน
- **JWT** (JSON Web Tokens) - สำหรับการจัดการด้านความปลอดภัยและการยืนยันตัวตน
- **TypeORM/Sequelize** - ORM สำหรับการจัดการกับฐานข้อมูล
- **PostgreSQL** - ฐานข้อมูล relational ที่ใช้เก็บข้อมูลผู้ใช้และสิทธิ์
- **bcryptjs** - สำหรับการเข้ารหัสรหัสผ่าน
- **SAML** - สำหรับการยืนยันตัวตนแบบ SSO
- **Swagger** - สำหรับการสร้างเอกสาร API

## ความต้องการของระบบ

- Node.js เวอร์ชัน 18.x หรือสูงกว่า
- npm เวอร์ชัน 8.x หรือสูงกว่า
- PostgreSQL เวอร์ชัน 14.x หรือสูงกว่า

## การติดตั้ง

```bash
# ติดตั้ง dependencies
$ npm install
```

## การตั้งค่า

1. สร้างไฟล์ `.env` ในโฟลเดอร์หลักของโปรเจค โดยใช้ `.env.example` เป็นแม่แบบ:

```bash
$ cp .env.example .env
```

2. แก้ไขค่าตัวแปรใน `.env` ตามความเหมาะสม เช่น การตั้งค่าการเชื่อมต่อฐานข้อมูล, port, และคีย์ลับต่างๆ

## วิธีการรัน

### โหมดพัฒนา

```bash
# รันแบบ development และทำการ reload อัตโนมัติเมื่อมีการเปลี่ยนแปลงโค้ด
$ npm run dev
```

### โหมดดีบัก

```bash
# รันแอปพลิเคชันในโหมดดีบัก
$ npm run debug
```

### โหมดโปรดักชัน

```bash
# สร้างไฟล์สำหรับ production
$ npm run build

# รันแอปพลิเคชันในโหมด production
$ npm run prod
```

หรือรันด้วยคำสั่งมาตรฐาน:

```bash
$ npm start
```

## การทดสอบ

```bash
# unit tests
$ npm test

# e2e tests
$ npm run test:e2e

# ทดสอบแบบแสดงความครอบคลุม (test coverage)
$ npm run test:cov
```

## โครงสร้างโปรเจค

โปรเจคถูกจัดวางตามรูปแบบ NestJS ซึ่งแบ่งเป็นโมดูลเพื่อการพัฒนาที่มีประสิทธิภาพ

```
/
├── certs/                      # เก็บ SSL และใบรับรองสำหรับ HTTPS และการเชื่อมต่อ SAML
├── src/                        # ส่วนโค้ดหลักที่พัฒนา
    ├── app.module.ts           # รวบรวมและจัดการการนำเข้าโมดูลต่างๆ ของระบบ
    ├── auth/                   # โมดูลจัดการ Authentication และ Authorization
    │   ├── auth.controller.ts  # รับ-ส่งคำขอ API สำหรับการเข้าสู่ระบบ ลงทะเบียน และอื่นๆ
    │   ├── auth.service.ts     # บริการตรวจสอบสิทธิ์ สร้าง JWT และจัดการการยืนยันตัวตน
    │   ├── auth.module.ts      # การกำหนดการเชื่อมต่อกับ passport และการตั้งค่าการยืนยัน
    │   ├── guards/             # กลไกตรวจสอบสิทธิ์ก่อนเข้าถึง endpoint ต่างๆ เช่น JwtAuthGuard
    │   ├── interfaces/         # นิยาม TypeScript ของโครงสร้างข้อมูลที่ใช้ในโมดูล auth
    │   └── strategies/         # กลยุทธ์การยืนยันตัวตนแบบต่างๆ เช่น JWT, SAML, Local
    ├── entities/               # โมเดลข้อมูลที่เชื่อมต่อกับฐานข้อมูล
    │   └── user.entity.ts      # โครงสร้างข้อมูลผู้ใช้ที่เชื่อมต่อกับตารางในฐานข้อมูล
    ├── users/                  # โมดูลจัดการข้อมูลผู้ใช้ระบบ
    │   ├── users.service.ts    # บริการค้นหา เพิ่ม แก้ไข ลบข้อมูลผู้ใช้ในฐานข้อมูล
    │   └── users.module.ts     # การกำหนดโครงสร้างของโมดูลผู้ใช้และการลงทะเบียน providers
    └── main.ts                 # จุดเริ่มต้นของแอปพลิเคชัน กำหนดค่า Swagger และตัวกรอง global
├── test/                       # ไฟล์ทดสอบ unit และ e2e สำหรับตรวจสอบคุณภาพโค้ด
```